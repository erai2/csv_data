<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>suri QnA AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-gap: 20px;
            min-height: 100vh;
        }

        /* í—¤ë” */
        .header {
            grid-column: 1 / -1;
            text-align: center;
            padding: 2rem 0;
            color: white;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            height: fit-content;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .sidebar h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .sidebar-section:last-child {
            border-bottom: none;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ */
        .upload-area {
            border: 2px dashed #007acc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background-color: #f8f9fa;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background-color: #e9ecef;
            border-color: #0056b3;
        }

        .upload-area.dragover {
            background-color: #cfe2ff;
            border-color: #0d6efd;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #495057);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        /* ë©”íŠ¸ë¦­ ì¹´ë“œ */
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #4CAF50;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #495057;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-button:hover {
            background: #e9ecef;
            color: #212529;
        }

        .tab-button.active {
            background: white;
            color: #007acc;
            border-bottom: 3px solid #007acc;
        }

        .tab-content {
            padding: 30px;
            min-height: 600px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ */
        .chat-container {
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #fafafa;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 15px;
            max-width: 80%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .message.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            margin-right: 0;
        }

        .message.assistant {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            margin-left: 0;
            margin-right: auto;
        }

        .message-meta {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 10px;
        }

        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .feedback-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .feedback-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid #ddd;
            background: white;
        }

        .chat-input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: #007acc;
            box-shadow: 0 0 10px rgba(0,122,204,0.3);
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* ì„¤ì • í¼ */
        .settings-form {
            display: grid;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #333;
        }

        .form-control {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #007acc;
            box-shadow: 0 0 5px rgba(0,122,204,0.3);
        }

        /* ì§„í–‰ ë°” */
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007acc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì•Œë¦¼ ë©”ì‹œì§€ */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border-color: #28a745;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: 10px;
            }

            .sidebar {
                order: 2;
            }

            .main-content {
                order: 1;
            }

            .header h1 {
                font-size: 2rem;
            }

            .message {
                max-width: 95%;
            }

            .tab-button {
                font-size: 14px;
                padding: 12px;
            }
        }

        /* íŒŒì¼ ëª©ë¡ */
        .file-list {
            list-style: none;
            padding: 0;
        }

        .file-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-item i {
            color: #007acc;
        }

        /* íˆë“  ì¸í’‹ */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1><i class="fas fa-crystal-ball"></i> ì‚¬ì£¼ëª…ë¦¬ AI ìƒë‹´ì‚¬</h1>
            <p>AI ê¸°ë°˜ ì „ë¬¸ ì‚¬ì£¼ëª…ë¦¬í•™ ìƒë‹´ ì„œë¹„ìŠ¤</p>
        </div>

        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <!-- ì§€ì‹ ë² ì´ìŠ¤ ê´€ë¦¬ -->
            <div class="sidebar-section">
                <h3><i class="fas fa-book"></i> ì§€ì‹ ë² ì´ìŠ¤ ê´€ë¦¬</h3>
                
                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="totalDocs">0</div>
                        <div class="metric-label">ì§€ì‹ ë¬¸ì„œ</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalChunks">0</div>
                        <div class="metric-label">í…ìŠ¤íŠ¸ ì²­í¬</div>
                    </div>
                </div>

                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt fa-2x" style="color: #007acc; margin-bottom: 10px;"></i>
                    <p>íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                    <small>TXT, MD, PDF íŒŒì¼ ì§€ì› (ìµœëŒ€ 10MB)</small>
                </div>
                
                <input type="file" id="fileInput" class="hidden" multiple accept=".txt,.md,.pdf">
                
                <button class="btn" onclick="rebuildDatabase()">
                    <i class="fas fa-sync-alt"></i> ë°ì´í„°ë² ì´ìŠ¤ ì¬êµ¬ì¶•
                </button>

                <div id="fileList">
                    <h4 style="margin: 15px 0 10px 0;">ì—…ë¡œë“œëœ íŒŒì¼:</h4>
                    <ul class="file-list" id="uploadedFiles"></ul>
                </div>
            </div>

            <!-- ëŒ€í™” ê´€ë¦¬ -->
            <div class="sidebar-section">
                <h3><i class="fas fa-comments"></i> ëŒ€í™” ê´€ë¦¬</h3>
                
                <div class="metric-card">
                    <div class="metric-value" id="chatCount">0</div>
                    <div class="metric-label">í˜„ì¬ ëŒ€í™” ìˆ˜</div>
                </div>

                <button class="btn btn-secondary" onclick="clearChat()">
                    <i class="fas fa-trash"></i> ëŒ€í™” ì‚­ì œ
                </button>
                
                <button class="btn btn-secondary" onclick="exportChat()">
                    <i class="fas fa-download"></i> ëŒ€í™” ì €ì¥
                </button>
            </div>

            <!-- ë°”ë¡œê°€ê¸° -->
            <div class="sidebar-section">
                <h3><i class="fas fa-link"></i> ë°”ë¡œê°€ê¸°</h3>
                <button class="btn btn-secondary" onclick="switchTab('analytics')">
                    <i class="fas fa-chart-bar"></i> ë¶„ì„
                </button>
                <button class="btn btn-secondary" onclick="switchTab('settings')">
                    <i class="fas fa-cog"></i> ì„¤ì •
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="main-content">
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="tab-nav">
                <button class="tab-button active" onclick="switchTab('chat')">
                    <i class="fas fa-comments"></i> AI ìƒë‹´
                </button>
                <button class="tab-button" onclick="switchTab('analytics')">
                    <i class="fas fa-chart-bar"></i> ë¶„ì„ ëŒ€ì‹œë³´ë“œ
                </button>
                <button class="tab-button" onclick="switchTab('settings')">
                    <i class="fas fa-cog"></i> ì„¤ì •
                </button>
            </div>

            <!-- ì±„íŒ… íƒ­ -->
            <div class="tab-content">
                <div class="tab-pane active" id="chatPane">
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="message assistant">
                                <div>ì•ˆë…•í•˜ì„¸ìš”! ì‚¬ì£¼ëª…ë¦¬ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.</div>
                                <div class="message-meta">
                                    <i class="fas fa-robot"></i> 2024-01-15 14:30:25
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" class="chat-input" id="chatInput" 
                                   placeholder="ì‚¬ì£¼ëª…ë¦¬í•™ì— ëŒ€í•´ ê¶ê¸ˆí•œ ê²ƒì„ ë¬¼ì–´ë³´ì„¸ìš”..." 
                                   onkeypress="handleChatInput(event)">
                        </div>
                    </div>
                </div>

                <!-- ë¶„ì„ íƒ­ -->
                <div class="tab-pane" id="analyticsPane">
                    <h2><i class="fas fa-chart-line"></i> ì‚¬ìš© í†µê³„</h2>
                    
                    <div class="metrics">
                        <div class="metric-card">
                            <div class="metric-value">24</div>
                            <div class="metric-label">ì´ ëŒ€í™” ìˆ˜</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">18</div>
                            <div class="metric-label">ê¸ì •ì  í”¼ë“œë°±</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">3</div>
                            <div class="metric-label">ë¶€ì •ì  í”¼ë“œë°±</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">85.7%</div>
                            <div class="metric-label">ë§Œì¡±ë„</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3>ì¸ê¸° ê²€ìƒ‰ì–´</h3>
                        <div style="padding: 20px;">
                            <div style="margin-bottom: 15px;">
                                <strong>ì‹­ì‹ </strong> - 45íšŒ (ì„±ê³µë¥ : 92%)
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 92%"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>ê°‘ëª© ì¼ê°„</strong> - 38íšŒ (ì„±ê³µë¥ : 89%)
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 89%"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>ëŒ€ìš´</strong> - 32íšŒ (ì„±ê³µë¥ : 95%)
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 95%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3>ì‹œìŠ¤í…œ ì„±ëŠ¥</h3>
                        <div class="metrics">
                            <div class="metric-card">
                                <div class="metric-value">1.2s</div>
                                <div class="metric-label">í‰ê·  ì‘ë‹µì‹œê°„</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">67%</div>
                                <div class="metric-label">ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">42%</div>
                                <div class="metric-label">CPU ì‚¬ìš©ë¥ </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì„¤ì • íƒ­ -->
                <div class="tab-pane" id="settingsPane">
                    <h2><i class="fas fa-cog"></i> ì‹œìŠ¤í…œ ì„¤ì •</h2>
                    
                    <div class="settings-form">
                        <h3>AI ëª¨ë¸ ì„¤ì •</h3>
                        <div class="form-group">
                            <label for="modelSelect">GPT ëª¨ë¸:</label>
                            <select class="form-control" id="modelSelect">
                                <option value="gpt-4o-mini">GPT-4o Mini</option>
                                <option value="gpt-4o">GPT-4o</option>
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="maxTokens">ìµœëŒ€ í† í° ìˆ˜:</label>
                            <input type="number" class="form-control" id="maxTokens" value="1500" min="100" max="4000">
                        </div>

                        <div class="form-group">
                            <label for="temperature">ì°½ì˜ì„± ìˆ˜ì¤€ (Temperature):</label>
                            <input type="range" class="form-control" id="temperature" min="0" max="1" step="0.1" value="0.3">
                            <small>í˜„ì¬ ê°’: <span id="temperatureValue">0.3</span></small>
                        </div>

                        <h3>ê²€ìƒ‰ ì—”ì§„ ì„¤ì •</h3>
                        <div class="form-group">
                            <label for="searchResults">ê²€ìƒ‰ ê²°ê³¼ ìˆ˜:</label>
                            <input type="number" class="form-control" id="searchResults" value="5" min="1" max="20">
                        </div>

                        <div class="form-group">
                            <label for="vectorWeight">ë²¡í„° ê²€ìƒ‰ ê°€ì¤‘ì¹˜:</label>
                            <input type="range" class="form-control" id="vectorWeight" min="0" max="1" step="0.1" value="0.6">
                            <small>í˜„ì¬ ê°’: <span id="vectorWeightValue">0.6</span></small>
                        </div>

                        <div class="form-group">
                            <label for="keywordWeight">í‚¤ì›Œë“œ ê²€ìƒ‰ ê°€ì¤‘ì¹˜:</label>
                            <input type="range" class="form-control" id="keywordWeight" min="0" max="1" step="0.1" value="0.4">
                            <small>í˜„ì¬ ê°’: <span id="keywordWeightValue">0.4</span></small>
                        </div>

                        <button class="btn" onclick="saveSettings()">
                            <i class="fas fa-save"></i> ì„¤ì • ì €ì¥
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let chatHistory = [];
        let uploadedFiles = [];
        let sessionId = generateSessionId();

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            updateMetrics();
        });

        function initializeApp() {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
            loadChatHistory();
            loadUploadedFiles();
            loadSettings();
        }

        function setupEventListeners() {
            // íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ ì´ë²¤íŠ¸
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            
            fileInput.addEventListener('change', handleFileSelect);

            // ìŠ¬ë¼ì´ë” ê°’ ì—…ë°ì´íŠ¸
            document.getElementById('temperature').addEventListener('input', function() {
                document.getElementById('temperatureValue').textContent = this.value;
            });

            document.getElementById('vectorWeight').addEventListener('input', function() {
                document.getElementById('vectorWeightValue').textContent = this.value;
                // í‚¤ì›Œë“œ ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •
                const keywordWeight = (1 - parseFloat(this.value)).toFixed(1);
                document.getElementById('keywordWeight').value = keywordWeight;
                document.getElementById('keywordWeightValue').textContent = keywordWeight;
            });

            document.getElementById('keywordWeight').addEventListener('input', function() {
                document.getElementById('keywordWeightValue').textContent = this.value;
                // ë²¡í„° ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •
                const vectorWeight = (1 - parseFloat(this.value)).toFixed(1);
                document.getElementById('vectorWeight').value = vectorWeight;
                document.getElementById('vectorWeightValue').textContent = vectorWeight;
            });
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + 'Pane').classList.add('active');
        }

        // ì±„íŒ… ì…ë ¥ ì²˜ë¦¬
        function handleChatInput(event) {
            if (event.key === 'Enter') {
                const input = event.target;
                const message = input.value.trim();
                if (message) {
                    sendMessage(message);
                    input.value = '';
                }
            }
        }

        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage(message) {
            const userMessage = {
                id: Date.now(),
                role: 'user',
                content: message,
                timestamp: new Date().toLocaleString()
            };

            chatHistory.push(userMessage);
            displayMessage(userMessage);

            // AI ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                const assistantMessage = {
                    id: Date.now(),
                    role: 'assistant',
                    content: aiResponse,
                    timestamp: new Date().toLocaleString(),
                    sources: generateMockSources()
                };

                chatHistory.push(assistantMessage);
                displayMessage(assistantMessage);
                saveChatHistory();
                updateMetrics();
            }, 1000);

            updateMetrics();
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function displayMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${message.role}`;
            messageEl.innerHTML = `
                <div>${message.content}</div>
                <div class="message-meta">
                    <i class="fas fa-${message.role === 'user' ? 'user' : 'robot'}"></i>
                    ${message.timestamp}
                </div>
                ${message.role === 'assistant' ? generateFeedbackButtons(message.id) : ''}
                ${message.sources ? generateSourcesSection(message.sources) : ''}
            `;

            messagesContainer.appendChild(messageEl);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // í”¼ë“œë°± ë²„íŠ¼ ìƒì„±
        function generateFeedbackButtons(messageId) {
            return `
                <div class="feedback-buttons">
                    <button class="feedback-btn" onclick="handleFeedback(${messageId}, 'positive')" title="ë„ì›€ì´ ë˜ì—ˆì–´ìš”">
                        ğŸ‘
                    </button>
                    <button class="feedback-btn" onclick="handleFeedback(${messageId}, 'negative')" title="ë„ì›€ì´ ë˜ì§€ ì•Šì•˜ì–´ìš”">
                        ğŸ‘
                    </button>
                    <button class="feedback-btn" onclick="regenerateResponse(${messageId})" title="ë‹µë³€ ì¬ìƒì„±">
                        ğŸ”„
                    </button>
                </div>
            `;
        }

        // ì†ŒìŠ¤ ì„¹ì…˜ ìƒì„±
        function generateSourcesSection(sources) {
            return `
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <details>
                        <summary style="cursor: pointer;">ğŸ“š ì°¸ê³  ìë£Œ (${sources.length}ê°œ)</summary>
                        <div style="margin-top: 10px;">
                            ${sources.map((source, i) => `
                                <div style="margin-bottom: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                    <strong>ì¶œì²˜ ${i+1}: ${source.filename}</strong><br>
                                    <div style="margin-top: 5px; font-size: 0.9em;">${source.content}</div>
                                </div>
                            `).join('')}
                        </div>
                    </details>
                </div>
            `;
        }

        // AI ì‘ë‹µ ìƒì„± (ì‹œë®¬ë ˆì´ì…˜)
        function generateAIResponse(userMessage) {
            const responses = [
                "ì‚¬ì£¼ëª…ë¦¬í•™ì—ì„œ ì‹­ì‹ (åç¥)ì€ ì¼ê°„ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë‹¤ë¥¸ ì²œê°„ê³¼ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¤‘ìš”í•œ ê°œë…ì…ë‹ˆë‹¤. ë¹„ê²¬, ê²ì¬, ì‹ì‹ , ìƒê´€, í¸ì¬, ì •ì¬, í¸ê´€, ì •ê´€, í¸ì¸, ì •ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
                "ê°‘ëª© ì¼ê°„ì€ ì–‘ì˜ ê¸°ìš´ì„ ê°€ì§„ ëª© ì˜¤í–‰ìœ¼ë¡œ, ë´„ì— íƒœì–´ë‚œ ê²½ìš° ì„±ì¥í•˜ëŠ” ë‚˜ë¬´ì˜ ì„±ê²©ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì ê·¹ì ì´ê³  ì§„ì·¨ì ì¸ ì„±í–¥ì„ ë³´ì´ëŠ” ê²ƒì´ íŠ¹ì§•ì…ë‹ˆë‹¤.",
                "ëŒ€ìš´ì€ 10ë…„ë§ˆë‹¤ ë°”ë€ŒëŠ” ìš´ì„¸ì˜ íë¦„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì›”ì£¼ì˜ ê°„ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•˜ë©°, ì¸ìƒì˜ í° ë³€í™”ì™€ íë¦„ì„ ì˜ˆì¸¡í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.",
                "ì²œê°„ê³¼ ì§€ì§€ì˜ ì¡°í•©ì€ ì‚¬ì£¼ í•´ì„ì—ì„œ ë§¤ìš° ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤. ê°ê°ì˜ ì¡°í•©ì´ ê°€ì§€ëŠ” ì˜ë¯¸ì™€ ìƒí˜¸ì‘ìš©ì„ í†µí•´ ê°œì¸ì˜ ì„±ê²©ê³¼ ìš´ì„¸ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            ];
            
            const randomIndex = Math.floor(Math.random() * responses.length);
            return responses[randomIndex];
        }

        // ëª¨ì˜ ì†ŒìŠ¤ ìƒì„±
        function generateMockSources() {
            return [
                {
                    filename: "ì‚¬ì£¼ëª…ë¦¬í•™_ê¸°ì´ˆì´ë¡ .txt",
                    content: "ì‹­ì‹ ì€ ì¼ê°„ì„ ì¤‘ì‹¬ìœ¼ë¡œ í•œ ê´€ê³„ ë¶„ì„ì˜ í•µì‹¬ ë„êµ¬ì…ë‹ˆë‹¤..."
                },
                {
                    filename: "ì²œê°„ì§€ì§€_í•´ì„ë²•.md", 
                    content: "ì²œê°„ê³¼ ì§€ì§€ì˜ ì¡°í•©ì„ í†µí•´ ê°œì¸ì˜ ì„±í–¥ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤..."
                }
            ];
        }

        // í”¼ë“œë°± ì²˜ë¦¬
        function handleFeedback(messageId, feedbackType) {
            showAlert(`í”¼ë“œë°±ì„ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ${feedbackType === 'positive' ? 'ğŸ‘' : 'ğŸ‘'}`, 'success');
            
            // í”¼ë“œë°± ì €ì¥ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€)
            const feedback = {
                messageId: messageId,
                type: feedbackType,
                timestamp: new Date().toISOString()
            };
            
            const existingFeedback = JSON.parse(localStorage.getItem('feedbackHistory') || '[]');
            existingFeedback.push(feedback);
            localStorage.setItem('feedbackHistory', JSON.stringify(existingFeedback));
        }

        // ë‹µë³€ ì¬ìƒì„±
        function regenerateResponse(messageId) {
            showAlert('ìƒˆë¡œìš´ ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ì¤‘...', 'warning');
            
            setTimeout(() => {
                // ê¸°ì¡´ ë©”ì‹œì§€ ì°¾ê¸°
                const messageIndex = chatHistory.findIndex(msg => msg.id === messageId);
                if (messageIndex > 0) {
                    const userMessage = chatHistory[messageIndex - 1].content;
                    const newResponse = generateAIResponse(userMessage);
                    
                    // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                    chatHistory[messageIndex].content = newResponse;
                    chatHistory[messageIndex].timestamp = new Date().toLocaleString();
                    
                    // í™”ë©´ ë‹¤ì‹œ ë Œë”ë§
                    refreshChatDisplay();
                    showAlert('ìƒˆë¡œìš´ ë‹µë³€ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }
            }, 1000);
        }

        // ì±„íŒ… í™”ë©´ ìƒˆë¡œê³ ì¹¨
        function refreshChatDisplay() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';
            
            chatHistory.forEach(message => {
                displayMessage(message);
            });
        }

        // íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function handleDragOver(e) {
            e.preventDefault();
            e.target.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.target.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (validateFile(file)) {
                    uploadFile(file);
                }
            });
        }

        function validateFile(file) {
            const allowedTypes = ['.txt', '.md', '.pdf'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            const maxSize = 10 * 1024 * 1024; // 10MB

            if (!allowedTypes.includes(fileExtension)) {
                showAlert(`ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${file.name}`, 'error');
                return false;
            }

            if (file.size > maxSize) {
                showAlert(`íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤: ${file.name}`, 'error');
                return false;
            }

            return true;
        }

        function uploadFile(file) {
            const fileInfo = {
                name: file.name,
                size: file.size,
                type: file.type,
                uploadTime: new Date().toISOString()
            };

            uploadedFiles.push(fileInfo);
            updateFileList();
            saveUploadedFiles();
            updateMetrics();

            showAlert(`íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤: ${file.name}`, 'success');
        }

        function updateFileList() {
            const fileListEl = document.getElementById('uploadedFiles');
            fileListEl.innerHTML = '';

            uploadedFiles.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <i class="fas fa-file-alt"></i>
                    <span>${file.name}</span>
                    <button class="btn btn-danger" style="margin-left: auto; padding: 2px 8px; font-size: 12px;" 
                            onclick="removeFile('${file.name}')">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                fileListEl.appendChild(li);
            });
        }

        function removeFile(fileName) {
            uploadedFiles = uploadedFiles.filter(file => file.name !== fileName);
            updateFileList();
            saveUploadedFiles();
            updateMetrics();
            showAlert(`íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤: ${fileName}`, 'warning');
        }

        // ë°ì´í„°ë² ì´ìŠ¤ ì¬êµ¬ì¶•
        function rebuildDatabase() {
            if (uploadedFiles.length === 0) {
                showAlert('ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            showAlert('ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¬êµ¬ì¶•í•˜ëŠ” ì¤‘...', 'warning');
            
            // ì§„í–‰ í‘œì‹œ
            const loadingDiv = document.createElement('div');
            loadingDiv.innerHTML = '<div class="loading-spinner"></div>';
            document.body.appendChild(loadingDiv);

            setTimeout(() => {
                document.body.removeChild(loadingDiv);
                showAlert('ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶•ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                updateMetrics();
            }, 3000);
        }

        // ì±„íŒ… ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function clearChat() {
            if (confirm('ëª¨ë“  ëŒ€í™”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                chatHistory = [];
                sessionId = generateSessionId();
                
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.innerHTML = `
                    <div class="message assistant">
                        <div>ì•ˆë…•í•˜ì„¸ìš”! ì‚¬ì£¼ëª…ë¦¬ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.</div>
                        <div class="message-meta">
                            <i class="fas fa-robot"></i> ${new Date().toLocaleString()}
                        </div>
                    </div>
                `;
                
                saveChatHistory();
                updateMetrics();
                showAlert('ëŒ€í™”ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        function exportChat() {
            if (chatHistory.length === 0) {
                showAlert('ì €ì¥í•  ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            const chatData = {
                sessionId: sessionId,
                timestamp: new Date().toISOString(),
                messages: chatHistory
            };

            const dataStr = JSON.stringify(chatData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `conversation_${sessionId.substring(0, 8)}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showAlert('ëŒ€í™”ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ì„¤ì • ê´€ë¦¬
        function saveSettings() {
            const settings = {
                model: document.getElementById('modelSelect').value,
                maxTokens: document.getElementById('maxTokens').value,
                temperature: document.getElementById('temperature').value,
                searchResults: document.getElementById('searchResults').value,
                vectorWeight: document.getElementById('vectorWeight').value,
                keywordWeight: document.getElementById('keywordWeight').value
            };

            localStorage.setItem('appSettings', JSON.stringify(settings));
            showAlert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
            
            if (settings.model) document.getElementById('modelSelect').value = settings.model;
            if (settings.maxTokens) document.getElementById('maxTokens').value = settings.maxTokens;
            if (settings.temperature) {
                document.getElementById('temperature').value = settings.temperature;
                document.getElementById('temperatureValue').textContent = settings.temperature;
            }
            if (settings.searchResults) document.getElementById('searchResults').value = settings.searchResults;
            if (settings.vectorWeight) {
                document.getElementById('vectorWeight').value = settings.vectorWeight;
                document.getElementById('vectorWeightValue').textContent = settings.vectorWeight;
            }
            if (settings.keywordWeight) {
                document.getElementById('keywordWeight').value = settings.keywordWeight;
                document.getElementById('keywordWeightValue').textContent = settings.keywordWeight;
            }
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬
        function saveChatHistory() {
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        }

        function loadChatHistory() {
            const saved = localStorage.getItem('chatHistory');
            if (saved) {
                chatHistory = JSON.parse(saved);
                refreshChatDisplay();
            }
        }

        function saveUploadedFiles() {
            localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
        }

        function loadUploadedFiles() {
            const saved = localStorage.getItem('uploadedFiles');
            if (saved) {
                uploadedFiles = JSON.parse(saved);
                updateFileList();
            }
        }

        // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
        function updateMetrics() {
            document.getElementById('totalDocs').textContent = uploadedFiles.length;
            document.getElementById('totalChunks').textContent = uploadedFiles.length * 3; // íŒŒì¼ë‹¹ í‰ê·  3ê°œ ì²­í¬ë¡œ ê°€ì •
            document.getElementById('chatCount').textContent = chatHistory.filter(msg => msg.role === 'user').length;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function generateSessionId() {
            return 'session_' + Math.random().toString(36).substr(2, 9);
        }

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (document.body.contains(alertDiv)) {
                    document.body.removeChild(alertDiv);
                }
            }, 3000);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            // Ctrl+Enterë¡œ ë©”ì‹œì§€ ì „ì†¡
            if (e.ctrlKey && e.key === 'Enter') {
                const chatInput = document.getElementById('chatInput');
                if (chatInput.value.trim()) {
                    sendMessage(chatInput.value.trim());
                    chatInput.value = '';
                }
            }
        });
    </script>
</body>
</html>
                                    