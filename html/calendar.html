<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>월간 스케줄 캘린더</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
        }
        .calendar-cell {
            height: 130px; /* 칸 높이 고정 */
            transition: background-color 0.3s;
        }
        .calendar-cell:hover {
            background-color: #f9fafb;
            cursor: pointer;
        }
        .day-name { font-weight: 500; }
        .day-number { font-weight: 700; }
        .event {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: flex;
            align-items: center;
        }
        .event-sticker {
            width: 16px;
            height: 16px;
            margin-right: 5px;
            flex-shrink: 0;
        }
        .modal-backdrop { transition: opacity 0.3s ease; }
        /* 월 바로가기 버튼 */
        .month-nav-btn {
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px; /* rounded-full */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            cursor: pointer;
        }
        .month-nav-btn:hover {
            background-color: #e5e7eb; /* gray-200 */
        }
        .month-nav-btn.active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        /* 스티커 선택 UI */
        .sticker-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        .sticker-option {
            width: 36px;
            height: 36px;
            object-fit: contain;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 6px;
            padding: 4px;
        }
        .sticker-option.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        /* 스크롤바 */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 6px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-lg">
        <div id="calendar-container" class="p-4 sm:p-6">
            <!-- 월 바로가기 내비게이션 -->
            <div id="month-navigation" class="flex justify-center items-center gap-1 sm:gap-2 mb-4 pb-4 border-b flex-wrap">
                <!-- 월 아이콘이 동적으로 생성될 영역 -->
            </div>

            <!-- 캘린더 헤더 -->
            <div class="flex items-center justify-between mb-4">
                <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <h2 id="current-month-year" class="text-2xl sm:text-3xl font-bold text-gray-800"></h2>
                <button id="next-month" class="p-2 rounded-full hover:bg-gray-200 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                </button>
            </div>
            
            <!-- 캘린더 본문 -->
            <div class="calendar-grid bg-gray-200 border border-gray-200 rounded-lg overflow-hidden">
                <div class="day-name text-center p-2 bg-gray-50 text-red-500">일</div>
                <div class="day-name text-center p-2 bg-gray-50">월</div>
                <div class="day-name text-center p-2 bg-gray-50">화</div>
                <div class="day-name text-center p-2 bg-gray-50">수</div>
                <div class="day-name text-center p-2 bg-gray-50">목</div>
                <div class="day-name text-center p-2 bg-gray-50">금</div>
                <div class="day-name text-center p-2 bg-gray-50 text-blue-500">토</div>
            </div>
            <div id="calendar-days" class="calendar-grid bg-gray-200 border-l border-r border-b border-gray-200 rounded-b-lg"></div>
        </div>
    </div>

    <!-- 스케줄 추가/수정 모달 -->
    <div id="event-modal" class="fixed inset-0 bg-gray-800 bg-opacity-50 modal-backdrop items-center justify-center hidden" style="opacity: 0;">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md m-4 p-6 transform transition-transform duration-300 scale-95">
            <h3 class="text-xl font-bold mb-4" id="modal-title">스케줄 추가</h3>
            <form id="event-form">
                <input type="hidden" id="event-id">
                <input type="hidden" id="event-sticker-src">
                <div>
                    <label for="event-date" class="block text-sm font-medium text-gray-700">날짜</label>
                    <input type="date" id="event-date" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required readonly>
                </div>
                <div class="mt-4">
                    <label for="event-text" class="block text-sm font-medium text-gray-700">내용</label>
                    <input type="text" id="event-text" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="예: ICN-NRT" required>
                </div>
                <div class="mt-4">
                    <label for="event-time" class="block text-sm font-medium text-gray-700">시간 (선택)</label>
                    <input type="text" id="event-time" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="예: 09:00-11:25">
                </div>
                <div class="mt-4">
                    <label for="event-color" class="block text-sm font-medium text-gray-700">색상</label>
                    <select id="event-color" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                        <option value="blue">파랑</option><option value="green">초록</option><option value="purple">보라</option><option value="orange">주황</option><option value="teal">청록</option><option value="indigo">남색</option><option value="pink">분홍</option><option value="gray">회색</option>
                    </select>
                </div>
                 <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700">스티커 (선택)</label>
                    <div id="sticker-selector" class="sticker-selector"></div>
                    <input type="text" id="sticker-url-input" class="mt-2 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="또는 이미지 URL 붙여넣기">
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="delete-event-btn" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 hidden">삭제</button>
                    <button type="button" id="cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">취소</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">저장</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendarDays = document.getElementById('calendar-days');
            const currentMonthYear = document.getElementById('current-month-year');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const monthNavigation = document.getElementById('month-navigation');
            const eventModal = document.getElementById('event-modal');
            const eventForm = document.getElementById('event-form');
            const cancelBtn = document.getElementById('cancel-btn');
            const deleteEventBtn = document.getElementById('delete-event-btn');
            const modalTitle = document.getElementById('modal-title');
            const eventDateInput = document.getElementById('event-date');
            const eventTextInput = document.getElementById('event-text');
            const eventTimeInput = document.getElementById('event-time');
            const eventColorInput = document.getElementById('event-color');
            const eventIdInput = document.getElementById('event-id');
            const eventStickerSrcInput = document.getElementById('event-sticker-src');
            const stickerSelector = document.getElementById('sticker-selector');
            const stickerUrlInput = document.getElementById('sticker-url-input');

            let currentDate = new Date();
            let scheduleData = {};
            
            const eventColors = {
                blue: 'bg-blue-100 text-blue-800', green: 'bg-green-100 text-green-800',
                purple: 'bg-purple-100 text-purple-800', orange: 'bg-orange-100 text-orange-800',
                teal: 'bg-teal-100 text-teal-800', indigo: 'bg-indigo-100 text-indigo-800',
                pink: 'bg-pink-100 text-pink-800', gray: 'bg-gray-100 text-gray-800'
            };

            const stickers = [
                'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iY3VycmVudENvbG9yIj48cGF0aCBkPSJNMjEuNCAxMy41TDE5IDEyLjNWOWMwLTEuMS0uOS0yLTItMmgLTMuNWMtMS4xIDAtMiAuOS0yIDJ2LjVMMiA4LjJVN2MwLS42LS40LTEtMS0xcy0xIC40LTEgMXYxMGMwIC42LjQgMSAxIDFzMS0uNCAxLTF2LTEuMmw5LjUtMy4zVjE1YzAgMS4xLjkgMiAyIDJIMTdjMS4xIDAgMi0uOSAyLTJ2LTIuN2wyLjQgMS4yYy40LjIuOSAwIDEuMS0uNC4zLS40LjItLjktLjItMS4xeiIvPjwvc3ZnPg==',
                'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iY3VycmVudENvbG9yIj48cGF0aCBkPSJNMjAgOUg0Yy0xLjEgMC0yIC45LTIgMnY3aDJ2LTNoMTZ2M2gydi03YzAtMS4xLS45LTItMi0yem0tNC00YzAtMS4xLS45LTItMi0yaC00Yy0xLjEgMC0yIC45LTIgMnYzaDhWNXoiLz48L3N2Zz4=',
                'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iY3VycmVudENvbG9yIj48cGF0aCBkPSJNMjAgNmgtMnYtMmMwLTEuMS0uOS0yLTItMkg4QzYuOSAyIDYgMi45IDYgNHYySDRjLTEuMSAwLTIgLjktMiAydjExYzAgMS4xLjkgMiAyIDJoMTZjMS4xIDAgMi0uOSAyLTJWOGMwLTEuMS0uOS0yLTItMnptLTgtNHYyaDRWM0gxMnoiLz48L3N2Zz4=',
                'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iY3VycmVudENvbG9yIj48cGF0aCBkPSJNNCAyMGg0djRIMHptNiAwaDR2NEg2em02IDBoNHY0aC00ek00IDE0aDR2NEgwem02IDBoNHY0aC00em02IDBoNHY0aC00ek00IDhoNHY0SDB6bTYgMGg0djRINnptNiAwIDEuNDQtMi44OEwyNCA4bC0yLjU2LTIuODhMMTggMGgtNGwzLjEyIDZMMTggMTJ6Ii8+PC9zdmc+'
            ];
            
            function generateMonthNavigation() {
                monthNavigation.innerHTML = '';
                for (let i = 0; i < 12; i++) {
                    const monthBtn = document.createElement('button');
                    monthBtn.textContent = i + 1;
                    monthBtn.className = 'month-nav-btn';
                    monthBtn.dataset.month = i;
                    monthBtn.onclick = () => {
                        currentDate.setMonth(i);
                        generateCalendar(currentDate);
                    };
                    monthNavigation.appendChild(monthBtn);
                }
            }
            
            function updateActiveMonthButton(month) {
                 monthNavigation.querySelectorAll('.month-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (parseInt(btn.dataset.month) === month) {
                        btn.classList.add('active');
                    }
                });
            }

            function initializeStickerSelector() {
                stickerSelector.innerHTML = '';
                stickers.forEach(src => {
                    const img = document.createElement('img');
                    img.src = src;
                    img.className = 'sticker-option';
                    img.onclick = () => selectSticker(img);
                    stickerSelector.appendChild(img);
                });
            }
            
            function selectSticker(selectedImg) {
                stickerSelector.querySelectorAll('.sticker-option').forEach(img => img.classList.remove('selected'));
                if(selectedImg) {
                   selectedImg.classList.add('selected');
                   eventStickerSrcInput.value = selectedImg.src;
                   stickerUrlInput.value = '';
                } else {
                   eventStickerSrcInput.value = '';
                }
            }
            
            stickerUrlInput.oninput = () => {
                selectSticker(null);
                eventStickerSrcInput.value = stickerUrlInput.value;
            };

            function loadSchedules() {
                const storedSchedules = localStorage.getItem('calendarSchedules');
                scheduleData = storedSchedules ? JSON.parse(storedSchedules) : {};
            }
            
            function saveSchedules() {
                localStorage.setItem('calendarSchedules', JSON.stringify(scheduleData));
            }

            function openModal(date, event = null) {
                eventModal.classList.remove('hidden');
                setTimeout(() => {
                    eventModal.style.opacity = '1';
                    eventModal.querySelector('div').classList.add('flex');
                    eventModal.querySelector('div').classList.remove('scale-95');
                }, 10);
                
                eventForm.reset();
                selectSticker(null);
                eventDateInput.value = date;

                if (event) {
                    modalTitle.textContent = "스케줄 수정";
                    eventIdInput.value = event.id;
                    eventTextInput.value = event.text;
                    eventTimeInput.value = event.time || '';
                    eventColorInput.value = event.color;
                    eventStickerSrcInput.value = event.sticker || '';

                    const predefinedSticker = Array.from(stickerSelector.children).find(img => img.src === event.sticker);
                    if(predefinedSticker) {
                        selectSticker(predefinedSticker);
                    } else if (event.sticker) {
                        stickerUrlInput.value = event.sticker;
                    }
                    deleteEventBtn.classList.remove('hidden');
                } else {
                    modalTitle.textContent = "스케줄 추가";
                    eventIdInput.value = '';
                    deleteEventBtn.classList.add('hidden');
                }
            }

            function closeModal() {
                eventModal.style.opacity = '0';
                eventModal.querySelector('div').classList.add('scale-95');
                setTimeout(() => {
                    eventModal.classList.add('hidden');
                    eventModal.classList.remove('flex');
                }, 300);
            }

            function generateCalendar(date) {
                calendarDays.innerHTML = '';
                const year = date.getFullYear();
                const month = date.getMonth();
                currentMonthYear.textContent = `${year}년 ${month + 1}월`;
                updateActiveMonthButton(month);

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDayOfMonth; i++) {
                    calendarDays.appendChild(Object.assign(document.createElement('div'), { className: 'calendar-cell bg-gray-50' }));
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateCell = Object.assign(document.createElement('div'), { className: 'calendar-cell relative p-2 bg-white' });
                    const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const dayNumber = Object.assign(document.createElement('span'), { className: 'day-number text-sm', textContent: day });
                    
                    const today = new Date();
                    if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                        dayNumber.classList.add('bg-blue-500', 'text-white', 'rounded-full', 'w-7', 'h-7', 'inline-flex', 'items-center', 'justify-center');
                    }
                    const dayOfWeek = new Date(year, month, day).getDay();
                    if (dayOfWeek === 0) dayNumber.classList.add('text-red-500');
                    if (dayOfWeek === 6) dayNumber.classList.add('text-blue-500');
                    
                    dateCell.appendChild(dayNumber);
                    dateCell.onclick = () => openModal(dateString);
                    
                    if (scheduleData[dateString]) {
                        const eventsContainer = Object.assign(document.createElement('div'), { className: 'mt-1 space-y-1 overflow-y-auto pr-1' });
                        eventsContainer.style.height = 'calc(100% - 30px)';
                        
                        scheduleData[dateString].forEach(eventData => {
                            const eventDiv = document.createElement('div');
                            eventDiv.className = `event ${eventColors[eventData.color] || eventColors.gray}`;
                            
                            if (eventData.sticker) {
                                const stickerImg = document.createElement('img');
                                stickerImg.src = eventData.sticker;
                                stickerImg.className = 'event-sticker';
                                eventDiv.appendChild(stickerImg);
                            }
                            
                            const textSpan = document.createElement('span');
                            textSpan.textContent = eventData.text + (eventData.time ? ` (${eventData.time})` : '');
                            eventDiv.appendChild(textSpan);
                            
                            eventDiv.onclick = (e) => { e.stopPropagation(); openModal(dateString, eventData); };
                            eventsContainer.appendChild(eventDiv);
                        });
                        dateCell.appendChild(eventsContainer);
                    }
                    calendarDays.appendChild(dateCell);
                }
            }

            eventForm.onsubmit = (e) => {
                e.preventDefault();
                const date = eventDateInput.value;
                const newEvent = {
                    id: eventIdInput.value ? Number(eventIdInput.value) : Date.now(),
                    text: eventTextInput.value,
                    time: eventTimeInput.value,
                    color: eventColorInput.value,
                    sticker: eventStickerSrcInput.value
                };

                if (eventIdInput.value) {
                    scheduleData[date] = scheduleData[date].map(event => event.id === newEvent.id ? newEvent : event);
                } else {
                    if (!scheduleData[date]) scheduleData[date] = [];
                    scheduleData[date].push(newEvent);
                }
                saveSchedules();
                generateCalendar(currentDate);
                closeModal();
            };
            
            deleteEventBtn.onclick = () => {
                const date = eventDateInput.value;
                const eventId = Number(eventIdInput.value);
                scheduleData[date] = scheduleData[date].filter(event => event.id !== eventId);
                if (scheduleData[date].length === 0) delete scheduleData[date];
                saveSchedules();
                generateCalendar(currentDate);
                closeModal();
            };

            cancelBtn.onclick = closeModal;
            eventModal.onclick = (e) => { if (e.target === eventModal) closeModal(); };
            prevMonthBtn.onclick = () => { currentDate.setMonth(currentDate.getMonth() - 1); generateCalendar(currentDate); };
            nextMonthBtn.onclick = () => { currentDate.setMonth(currentDate.getMonth() + 1); generateCalendar(currentDate); };
            
            generateMonthNavigation();
            initializeStickerSelector();
            loadSchedules();
            generateCalendar(currentDate);
        });
    </script>
</body>
</html>

